<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>기하 분포 그래프</title>
    <link rel="stylesheet" href="style-calculator.css"> <!-- 외부 CSS 파일을 불러옴 -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
    </script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
</head>
<body>
    <header>
        <nav>
          <ul>
            <li><a href="../../">홈</a></li>
            <li><a href="coin.html">교환코인 계산기</a></li>
            <!-- 다른 페이지에 대한 메뉴 항목 추가 -->
          </ul>
        </nav>
      </header> <br>

    <!-- 입력 폼 -->
    <div class=inputNum>
        <span>성공 확률: </span>
        <input type="number" id="pValue" step="0.01" value="0.24" min="0" max="1" oninput="updateChart()">
        <span>%</span>
    </div>
    <div class=inputNum>
        <input type="number" id="startX" step="50" value="1" min="1" oninput="updateChart()">
        <span>번째와 </span>
        <input type="number" id="endX" step="50" value="500" min="1" min="5000" oninput="updateChart()">
        <span>번째 시도 사이에 처음 성공할 확률:</span>
    </div>
    
    <!-- 결과 출력 -->
    <div id="result" class="resultBox"></div>
    
    <!-- 차트 캔버스 -->
    <canvas id="myChart"></canvas>


    <script>
        // 초기 파라미터 설정
        let p, startX, endX;

        // 초기화 함수
        function initializeParams() {
            p = parseFloat(document.getElementById('pValue').value / 100);
            startX = parseInt(document.getElementById('startX').value);
            endX = parseInt(document.getElementById('endX').value);
        }

        // 기하 분포의 확률 계산 함수
        function calculateProbabilities(startX, endX) {
            return Array.from({ length: endX+200 }, (_, i) => (Math.pow(1 - p, i) * p) * 100);
        }

        // 차트 업데이트 함수
        function updateChart() {
            initializeParams();

            const probabilities = calculateProbabilities(startX, endX);

            // 데이터셋 갱신
            myChart.data.datasets[0].data = probabilities;
            myChart.data.datasets[1].data = probabilities.map((val, index) => {
                return (index >= labels.indexOf(startX) && index <= labels.indexOf(endX)) ? val : null;
            });

            // 차트 업데이트
            myChart.update();

            // 영역을 재계산하고 표시
            const newArea = calculateArea(labels, probabilities, startX, endX);
            displayArea(startX, endX, newArea);

            MathJax.typeset();
        }

        // 리만 적분을 통한 영역 계산 함수
        function calculateArea(labels, probabilities, startX, endX) {
        const startIndex = labels.indexOf(startX);
        const endIndex = labels.indexOf(endX);

        let area = 0;
        const labelDiff = labels[1] - labels[0]; // 간격 계산

        for (let i = startIndex; i < endIndex - 1; i++) {
            const width = labelDiff;
            const heightAvg = (probabilities[i] + probabilities[i + 1]) / 2;
            area += width * heightAvg;
        }

        return area;
    }

        // 결과 출력 함수
        function displayArea(startX, endX, area) {
            const roundedArea = area.toFixed(3);
            const resultElement = document.getElementById('result');
            resultElement.innerHTML = `\\( \\int_{${startX}}^{${endX}} P(x) \\, dx = ${roundedArea}\\% \\)`;
        }

        // 라벨 생성
        const labels = Array.from({ length: 5000 }, (_, i) => i + 1);

        // 차트 생성
        const canvas = document.getElementById('myChart');
        const ctx = canvas.getContext('2d');

        const myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: '기하 분포',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        fill: true,
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    },
                    {
                        label: '강조 영역',
                        borderColor: 'transparent',
                        borderWidth: 0,
                        fill: true,
                        backgroundColor: 'rgba(75, 192, 192, 0.4)',
                    },
                ],
            },
            options: {
                maintainAspectRatio: true,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        max: endX + 200,
                    },
                    y: {
                        type: 'linear',
                        position: 'left',
                    },
                },
            },
        });

        initializeParams(); // 초기화 함수 호출
        updateChart(); // 초기 차트 업데이트

        
    </script>
</body>
</html>
