<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>기하 분포 그래프</title>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #myChart {
            max-width: 800px;
            width: 100%;
            max-height: 400px;
        }
    </style>
</head>
<body>
    <!-- 입력 폼 -->
    <label for="pValue">확률 (%):</label>
    <input type="number" id="pValue" step="0.01" value="0.24" min="0" max="1" oninput="updateChart()">

    <label for="startX">시작 X:</label>
    <input type="number" id="startX" step="100" value="1" min="1" oninput="updateChart()">

    <label for="endX">종료 X:</label>
    <input type="number" id="endX" step="100" value="500" min="1" max="1600" oninput="updateChart()">

    <br>
    <!-- 결과 출력 -->
    <span>결과: </span><div id="result"></div>

    <!-- 차트 캔버스 -->
    <canvas id="myChart"></canvas>

    <script>
        // 초기 파라미터 설정
        let p, startX, endX;

        // 초기화 함수
        function initializeParams() {
            p = parseFloat(document.getElementById('pValue').value / 100);
            startX = parseInt(document.getElementById('startX').value);
            endX = parseInt(document.getElementById('endX').value);
        }

        // 기하 분포의 확률 계산 함수
        function calculateProbabilities() {
            return Array.from({ length: 1600 }, (_, i) => (Math.pow(1 - p, i) * p) * 100);
        }

        // 차트 업데이트 함수
        function updateChart() {
            initializeParams();

            const probabilities = calculateProbabilities();

            // 데이터셋 갱신
            myChart.data.datasets[0].data = probabilities;
            myChart.data.datasets[1].data = probabilities.map((val, index) => {
                return (index >= labels.indexOf(startX) && index <= labels.indexOf(endX)) ? val : null;
            });

            // 차트 업데이트
            myChart.update();

            // 영역을 재계산하고 표시
            const newArea = calculateArea(labels, probabilities, startX, endX);
            displayArea(startX, endX, newArea);
        }

        // 리만 적분을 통한 영역 계산 함수
        function calculateArea(labels, probabilities, startX, endX) {
            const startIndex = labels.indexOf(startX);
            const endIndex = labels.indexOf(endX);

            let area = 0;
            for (let i = startIndex; i < endIndex - 1; i++) {
                const width = labels[i + 1] - labels[i];
                const heightAvg = (probabilities[i] + probabilities[i + 1]) / 2;
                area += width * heightAvg;
            }

            return area;
        }

        // 결과 출력 함수
        function displayArea(startX, endX, area) {
            const roundedArea = area.toFixed(3);
            const resultElement = document.getElementById('result');
            resultElement.innerHTML = `x=${startX}부터 x=${endX}까지의 곡선 아래 영역: ${roundedArea}`;
        }

        // 라벨 생성
        const labels = Array.from({ length: 1600 }, (_, i) => i + 1);

        // 차트 생성
        const canvas = document.getElementById('myChart');
        const ctx = canvas.getContext('2d');

        const myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: '기하 분포',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        fill: true,
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    },
                    {
                        label: '강조 영역',
                        borderColor: 'transparent',
                        borderWidth: 0,
                        fill: true,
                        backgroundColor: 'rgba(75, 192, 192, 0.4)',
                    },
                ],
            },
            options: {
                maintainAspectRatio: true,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                    },
                    y: {
                        type: 'linear',
                        position: 'left',
                    },
                },
            },
        });

        initializeParams(); // 초기화 함수 호출
        updateChart(); // 초기 차트 업데이트
    </script>
</body>
</html>
